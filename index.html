<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSVP - Kuf Munyinda's 70th Birthday</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="card-container">
        <div class="card">
            <!-- Security and Numbering -->
            <div class="card-header-meta">
                <div class="card-number">INVITE ID: <span id="invite-id">KM70-XXXX</span></div>
                <div class="guest-name">TO: <span id="guest-name-display">____________________________</span></div>
            </div>

            <!-- Corner Ornaments -->
            <div class="ornament bottom-left">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10,90 Q30,90 40,70 T60,50 M10,90 Q10,70 30,60 T50,40 M10,90 Q20,80 15,65 M10,90 Q25,85 35,95" fill="none" stroke="black" stroke-width="1"/>
                    <circle cx="15" cy="85" r="2" fill="black"/>
                    <circle cx="25" cy="75" r="1.5" fill="black"/>
                    <path d="M10,90 C15,80 25,80 30,90" fill="none" stroke="black" stroke-width="0.5"/>
                    <!-- Simplified floral shapes -->
                    <path d="M5,95 L15,85 M2,90 L12,80" stroke="black" stroke-width="0.5"/>
                </svg>
            </div>
            <div class="ornament bottom-right">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path d="M90,90 Q70,90 60,70 T40,50 M90,90 Q90,70 70,60 T50,40 M90,90 Q80,80 85,65 M90,90 Q75,85 65,95" fill="none" stroke="black" stroke-width="1"/>
                    <circle cx="85" cy="85" r="2" fill="black"/>
                    <circle cx="75" cy="75" r="1.5" fill="black"/>
                    <path d="M90,90 C85,80 75,80 70,90" fill="none" stroke="black" stroke-width="0.5"/>
                    <path d="M95,95 L85,85 M98,90 L88,80" stroke="black" stroke-width="0.5"/>
                </svg>
            </div>

            <div class="content">
                <header>
                    <p class="family-text">THE FAMILY</p>
                </header>

                <div class="main-invite">
                    <p class="request-text">REQUEST YOUR PRESENCE AT</p>
                    <h1 class="celebrant-name">Kuf Munyinda's</h1>
                    <h2 class="event-title">70th Birthday</h2>
                </div>

                <div class="venue-section">
                    <p class="venue-label">VENUE</p>
                    <p class="venue-name">Ivy Hotel, Great North Road</p>
                    <p class="time">15 Hours</p>
                </div>

                <div class="gift-section">
                    <p class="gifts">GIFTS IN ANY FORM</p>
                    <p class="appreciation">WILL BE GREATLY APPRECIATED</p>
                </div>

                <div class="restrictions">
                    <p class="invitation-only">STRICTLY BY INVITATION</p>
                    <p class="non-transferable">NON-TRANSFERABLE â€¢ ADMIT ONE</p>
                    <p class="no-children">REGRETTABLY, NO CHILDREN.</p>
                </div>

                <div class="rsvp-section">
                    <h3 class="rsvp-title">Rsvp</h3>
                    <div class="rsvp-contacts">
                        <p>HON. MABLE NJEKWA: 0977766136</p>
                        <p>MRS NAMAKAU KABWE: 0977704519</p>
                    </div>
                </div>

                <!-- Digital Security QR Code -->
                <div class="qr-container">
                    <img id="qr-code" src="" alt="Scan for verification">
                    <p class="verification-text">SCAN FOR ENTRY VERIFICATION</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Digital Security Logic
        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split("&").forEach(pair => {
                if (pair === "") return;
                const [key, value] = pair.split("=");
                params[decodeURIComponent(key)] = decodeURIComponent(value);
            });
            return params;
        }

        const params = getQueryParams();
        const inviteId = params.id || "KM70-" + Math.random().toString(36).substr(2, 6).toUpperCase();
        const guestName = params.name || "Valued Guest";
        const eventKey = params.ek || "KM70-DEFAULT";

        // Update card with dynamic data
        document.getElementById('invite-id').textContent = inviteId;
        document.getElementById('guest-name-display').textContent = guestName;

        // Generate QR Code using a more reliable API (api.qrserver.com)
        // Using current path instead of origin to support GitHub Pages subdirectories
        const basePath = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
        const verificationUrl = basePath + "verify.html?id=" + inviteId + "&name=" + encodeURIComponent(guestName) + "&ek=" + encodeURIComponent(eventKey);
        
        console.log("Verification URL:", verificationUrl);

        const qrImg = document.getElementById('qr-code');
        
        qrImg.onerror = function() {
            console.error("Failed to load QR code image.");
            const container = document.querySelector('.qr-container');
            const errorMsg = document.createElement('p');
            errorMsg.style.fontSize = '0.6rem';
            errorMsg.style.color = 'red';
            errorMsg.textContent = "QR Code unavailable. ID: " + inviteId;
            container.appendChild(errorMsg);
        };
        
        qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(verificationUrl)}`;
    </script>
</body>
</html>
